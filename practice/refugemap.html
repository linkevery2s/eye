<!DOCTYPE HTML>
<html lang="ja">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
	<meta charset='UTF-8' name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no'>
	<meta name="author" content="仁志">
	<meta name="keywords" content="防災,災害対策,指定緊急避難場所">

	<style>
		html,
		body,
		#map {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
			z-index: 0;
		}

		.select_button{
			z-index: 20000;
			position: fixed;
			top: 10px;
			width: 300px;
			left: calc(50% - 150px);

		}

		#pop_moji{
			color: #ff0000;
			font-size: 16px !important;

		}

		select {
			-moz-appearance: none;
			-webkit-appearance: none;
			-ms-appearance: none;
			appearance: none;
		}

	</style>

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
	<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
	<link href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" rel="stylesheet">
	<script src="https://use.fontawesome.com/releases/v5.6.3/js/all.js"></script>
	<script src="./refugedata/hokkaido.geojson"></script>
	<script src="./refugedata/aomori.geojson"></script>
	<script src="./refugedata/iwate.geojson"></script>
	<script src="./refugedata/miyagi.geojson"></script>
	<script src="./refugedata/akita.geojson"></script>
	<script src="./refugedata/yamagata.geojson"></script>
	<script src="./refugedata/fukushima.geojson"></script>
	<script src="./refugedata/ibaraki.geojson"></script>
	<script src="./refugedata/tochigi.geojson"></script>
	<script src="./refugedata/gunma.geojson"></script>
	<script src="./refugedata/saitama.geojson"></script>
	<script src="./refugedata/tiba.geojson"></script>
	<script src="./refugedata/tokyo.geojson"></script>
	<script src="./refugedata/kanagawa.geojson"></script>
	<script src="./refugedata/nigata.geojson"></script>
	<script src="./refugedata/toyama.geojson"></script>
	<script src="./refugedata/ishikawa.geojson"></script>
	<script src="./refugedata/fukui.geojson"></script>
	<script src="./refugedata/yamanashi.geojson"></script>
	<script src="./refugedata/nagano.geojson"></script>
	<script src="./refugedata/gifu.geojson"></script>
	<script src="./refugedata/shizuoka.geojson"></script>
	<script src="./refugedata/aichi.geojson"></script>
	<script src="./refugedata/mie.geojson"></script>
	<script src="./refugedata/shiga.geojson"></script>
	<script src="./refugedata/kyoto.geojson"></script>
	<script src="./refugedata/osaka.geojson"></script>
	<script src="./refugedata/hyogo.geojson"></script>
	<script src="./refugedata/nara.geojson"></script>
	<script src="./refugedata/wakayama.geojson"></script>
	<script src="./refugedata/tottori.geojson"></script>
	<script src="./refugedata/shimane.geojson"></script>
	<script src="./refugedata/hiroshima.geojson"></script>
	<script src="./refugedata/okayama.geojson"></script>
	<script src="./refugedata/yamaguchi.geojson"></script>
	<script src="./refugedata/tokushima.geojson"></script>
	<script src="./refugedata/kagawa.geojson"></script>
	<script src="./refugedata/ehime.geojson"></script>
	<script src="./refugedata/kochi.geojson"></script>
	<script src="./refugedata/fukuoka.geojson"></script>
	<script src="./refugedata/saga.geojson"></script>
	<script src="./refugedata/nagasaki.geojson"></script>
	<script src="./refugedata/kumamoto.geojson"></script>
	<script src="./refugedata/oita.geojson"></script>
	<script src="./refugedata/miyazaki.geojson"></script>
	<script src="./refugedata/kagoshima.geojson"></script>
	<script src="./refugedata/okinawa.geojson"></script>

	<script type="text/javascript" src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
	<link rel = "stylesheet" type = "text/css" href = "https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
	<link rel = "stylesheet" type = "text/css" href = "https://unpkg.com/leaflet.markercluster@1.4.1/dist//MarkerCluster.Default.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
	<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
	<link rel="stylesheet" href="./lib/L.Icon.Pulse.css">
	<script src="./lib/L.Icon.Pulse.js"></script>

	<script type='module'>

		onload = async () => {
			let tiri = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="http://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>,<a href="https://www.gsi.go.jp/bousaichiri/hinanbasho.html" target="_blank">指定緊急避難場所データ</a>'
			});

			const map = L.map('map', {
				center: [34.624, 135.341],
				maxZoom: 18,
				minZoom: 4,
				zoomControl: false,
				zoom: 7,
				layers: tiri
			});

			L.control.zoom({
				position: 'topright'
			}).addTo(map);

			let b = 0;let marker1;let marker2;let ido; let keido;

			let gps_get = (position) => {
				ido = position.coords.latitude;
				keido = position.coords.longitude;
				map.setView([ido, keido], 15);

				let pulsingIcon = L.icon.pulse({iconSize:[12,12],color:'#2ca9e1', fillColor: '#2ca9e1'});

				if( b == 0 ){
					marker1 = L.marker([ido, keido] ,{icon: pulsingIcon}).addTo(map);

					b=1;

					marker2.onRemove(map);

				}
				else{
					marker1.onRemove(map);

					marker2 = L.marker([ido, keido] ,{icon: pulsingIcon}).addTo(map);

					b=0;

				}
			}

			let gps_error = (error) => {
				alert("エラーが発生したので、現在地を取得できませんでした。");
			}

			let GPS = () =>{
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(gps_get,gps_error);
				} else {
					alert("エラーが発生したので、現在地を取得できませんでした。");
				}
			}

			let gps_button = L.easyButton('fa-location-arrow', function(){ GPS();}, {position: 'topright'}).addTo( map );


			/*let geo_layer = [];

			window.select_change = () => {

			map.removeLayer(geo_layer);

			let select_value = select.value;

			console.log(select_value);

			if(select_value == 1){
				map.setView([43.449, 142.707], 8);
				geo_layer = L.geoJSON(hokkaido,{onEachFeature: popup_pin, pointToLayer: iro}).addTo(map);

			}
			else if(select_value == 21){

				map.setView([35.816, 136.980], 8);
				geo_layer = L.geoJSON(gifu,{onEachFeature: popup_pin, pointToLayer: iro}).addTo(map);

			}
			
		}*/

			let pref = new Array(47);let markers = new Array(47);

			let popup_pin = (feature, layer) => {
				let popup;
				if (feature.properties && feature.properties.Name) {
					popup = "名称：" + feature.properties.Name;
				}

				if (feature.properties && feature.properties.Jusho){
					popup += '<br>住所：' + feature.properties.Jusho;
				}

				if (feature.properties && feature.properties.kouzui){
					popup += '<br>洪水：<span id = "pop_moji">' + feature.properties.kouzui + '</span>';
				}

				if (feature.properties && feature.properties.gake){
					popup += '　がけ崩れ、土石流及び地滑り：<span id = "pop_moji">' + feature.properties.gake + '</span><br>';
				}

				if (feature.properties && feature.properties.takashio){
					popup += '高潮：<span id = "pop_moji">' + feature.properties.takashio + '</span>';
				}

				if (feature.properties && feature.properties.jishin){
					popup += '　地震：<span id = "pop_moji">' + feature.properties.jishin + '</span>';
				}

				if (feature.properties && feature.properties.tsunami){
					popup += '　津波：<span id = "pop_moji">' + feature.properties.tsunami + '</span><br>';
				}

				if (feature.properties && feature.properties.kaji){
					popup += '大規模な火事：<span id = "pop_moji">' + feature.properties.kaji + '</span>';
				}

				if (feature.properties && feature.properties.naisui){
					popup += '　内水氾濫：<span id = "pop_moji">' + feature.properties.naisui + '</span>';
				}

				if (feature.properties && feature.properties.kazan){
					popup += '　火山：<span id = "pop_moji">' + feature.properties.kazan + '</span>';
				}

				layer.bindPopup(popup);
			}

			let iro = (feature, latlng) => {
				return L.circleMarker(latlng, {
					radius: 8,
					fillColor: "#e2041b",
					color: "#ffffff",
					weight: 1,
					opacity: 1,
					fillOpacity: 0.8
				});
			}

			pref[0] = L.geoJson(hokkaido, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[1] = L.geoJson(aomori, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[2] = L.geoJson(iwate, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[3] = L.geoJson(miyagi, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[4] = L.geoJson(akita, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[5] = L.geoJson(yamagata, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[6] = L.geoJson(fukushima, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[7] = L.geoJson(ibaraki, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[8] = L.geoJson(tochigi, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[9] = L.geoJson(gunma, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[10] = L.geoJson(saitama, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[11] = L.geoJson(tiba, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[12] = L.geoJson(tokyo, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[13] = L.geoJson(kanagawa, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[14] = L.geoJson(nigata, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[15] = L.geoJson(toyama, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[16] = L.geoJson(ishikawa, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[17] = L.geoJson(fukui, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[18] = L.geoJson(yamanashi, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[19] = L.geoJson(nagano, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[20] = L.geoJson(gifu, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[21] = L.geoJson(shizuoka, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[22] = L.geoJson(aichi, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[23] = L.geoJson(mie, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[24] = L.geoJson(shiga, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[25] = L.geoJson(kyoto, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[26] = L.geoJson(osaka, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[27] = L.geoJson(hyogo, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[28] = L.geoJson(nara, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[29] = L.geoJson(wakayama, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[30] = L.geoJson(tottori, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[31] = L.geoJson(shimane, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[32] = L.geoJson(hiroshima, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[33] = L.geoJson(okayama, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[34] = L.geoJson(yamaguchi, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[35] = L.geoJson(tokushima, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[36] = L.geoJson(kagawa, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[37] = L.geoJson(ehime, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[38] = L.geoJson(kochi, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[39] = L.geoJson(fukuoka, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[40] = L.geoJson(saga, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[41] = L.geoJson(nagasaki, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[42] = L.geoJson(kumamoto, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[43] = L.geoJson(oita, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[44] = L.geoJson(miyazaki, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[45] = L.geoJson(kagoshima, {onEachFeature: popup_pin,pointToLayer: iro});
			pref[46] = L.geoJson(okinawa, {onEachFeature: popup_pin,pointToLayer: iro});

			
			for ( let i = 0;  i < 47;  i++  ) {
				markers[i] = L.markerClusterGroup({disableClusteringAtZoom: 12});
				markers[i].addLayer(pref[i]);
				map.addLayer(markers[i]);
			}				
			

		}



	</script>



	<title>指定緊急避難場所</title>

</head>

<body>

	<div id='map'></div>

	<!--<center>
		<div class="select_button">
			<select name="pref_id" id = "select" onchange="select_change();">
				<option value="" selected> - 都道府県選択 - </option>
				<option value="1">北海道</option>
				<option value="2">青森県</option>
				<option value="3">岩手県</option>
				<option value="4">宮城県</option>
				<option value="5">秋田県</option>
				<option value="6">山形県</option>
				<option value="7">福島県</option>
				<option value="8">茨城県</option>
				<option value="9">栃木県</option>
				<option value="10">群馬県</option>
				<option value="11">埼玉県</option>
				<option value="12">千葉県</option>
				<option value="13">東京都</option>
				<option value="14">神奈川県</option>
				<option value="15">新潟県</option>
				<option value="16">富山県</option>
				<option value="17">石川県</option>
				<option value="18">福井県</option>
				<option value="19">山梨県</option>
				<option value="20">長野県</option>
				<option value="21">岐阜県</option>
				<option value="22">静岡県</option>
				<option value="23">愛知県</option>
				<option value="24">三重県</option>
				<option value="25">滋賀県</option>
				<option value="26">京都府</option>
				<option value="27">大阪府</option>
				<option value="28">兵庫県</option>
				<option value="29">奈良県</option>
				<option value="30">和歌山県</option>
				<option value="31">鳥取県</option>
				<option value="32">島根県</option>
				<option value="33">岡山県</option>
				<option value="34">広島県</option>
				<option value="35">山口県</option>
				<option value="36">徳島県</option>
				<option value="37">香川県</option>
				<option value="38">愛媛県</option>
				<option value="39">高知県</option>
				<option value="40">福岡県</option>
				<option value="41">佐賀県</option>
				<option value="42">長崎県</option>
				<option value="43">熊本県</option>
				<option value="44">大分県</option>
				<option value="45">宮崎県</option>
				<option value="46">鹿児島県</option>
				<option value="47">沖縄県</option>
			</select>
		</div>
	</center>-->

</body>

</html>
