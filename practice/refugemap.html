<!DOCTYPE HTML>
<html lang="ja">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
	<meta charset='UTF-8' name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no'>
	<meta name="author" content="仁志">
	<meta name="keywords" content="防災,災害対策,指定緊急避難場所">

	<style>
		html,
		body,
		#map {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
			z-index: 0;
		}

		.select_button{
			z-index: 20000;
			position: fixed;
			top: 10px;
			width: 300px;
			left: calc(50% - 150px);

		}

		#pop_moji{
			color: #ff0000;
			font-size: 16px !important;

		}

		select {
			-moz-appearance: none;
			-webkit-appearance: none;
			-ms-appearance: none;
			appearance: none;
		}

	</style>

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
	<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
	<link href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" rel="stylesheet">
	<script src="https://use.fontawesome.com/releases/v5.6.3/js/all.js"></script>
	<script src="./refugedata/hokkaido.geojson"></script>
	<script src="./refugedata/gifu.geojson"></script>

	<script type='module'>

		onload = async () => {
			let tiri = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="http://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>,<a href="https://www.gsi.go.jp/bousaichiri/hinanbasho.html" target="_blank">指定緊急避難場所データ</a>'
			});

			const map = L.map('map', {
				center: [34.624, 135.341],
				maxZoom: 14,
				minZoom: 4,
				zoomControl: false,
				zoom: 7,
				layers: tiri
			});

			L.control.zoom({
				position: 'topright'
			}).addTo(map);


			let geo_layer = [];

			window.select_change = () => {

				map.removeLayer(geo_layer);

				let select_value = select.value;

				console.log(select_value);

				if(select_value == 1){
					map.setView([43.449, 142.707], 8);
					geo_layer = L.geoJSON(hokkaido,{onEachFeature: popup_pin, pointToLayer: iro}).addTo(map);

				}
				else if(select_value == 21){

					map.setView([35.816, 136.980], 8);
					geo_layer = L.geoJSON(gifu,{onEachFeature: popup_pin, pointToLayer: iro}).addTo(map);

				}
				
			}

			let popup_pin = (feature, layer) => {
				let popup;
				if (feature.properties && feature.properties.Name) {
					popup = "名称：" + feature.properties.Name;
				}

				if (feature.properties && feature.properties.Jusho){
					popup += '<br>住所：' + feature.properties.Jusho;
				}

				if (feature.properties && feature.properties.kouzui){
					popup += '<br>洪水：<span id = "pop_moji">' + feature.properties.kouzui + '</span>';
				}

				if (feature.properties && feature.properties.gake){
					popup += '　がけ崩れ、土石流及び地滑り：<span id = "pop_moji">' + feature.properties.gake + '</span><br>';
				}

				if (feature.properties && feature.properties.takashio){
					popup += '高潮：<span id = "pop_moji">' + feature.properties.takashio + '</span>';
				}

				if (feature.properties && feature.properties.jishin){
					popup += '　地震：<span id = "pop_moji">' + feature.properties.jishin + '</span>';
				}

				if (feature.properties && feature.properties.tsunami){
					popup += '　津波：<span id = "pop_moji">' + feature.properties.tsunami + '</span><br>';
				}

				if (feature.properties && feature.properties.kaji){
					popup += '大規模な火事：<span id = "pop_moji">' + feature.properties.kaji + '</span>';
				}

				if (feature.properties && feature.properties.naisui){
					popup += '　内水氾濫：<span id = "pop_moji">' + feature.properties.naisui + '</span>';
				}

				if (feature.properties && feature.properties.kazan){
					popup += '　火山：<span id = "pop_moji">' + feature.properties.kazan + '</span>';
				}

				layer.bindPopup(popup);
			}

			let iro = (feature, latlng) => {
				return L.circleMarker(latlng, {
					radius: 10,
					fillColor: "#006e54",
					color: "#ffffff",
					weight: 1,
					opacity: 1,
					fillOpacity: 0.8
				});
			}


		}



	</script>



	<title>指定緊急避難場所</title>

</head>

<body>

	<div id='map'></div>

	<center>
		<div class="select_button">
			<select name="pref_id" id = "select" onchange="select_change();">
				<option value="" selected> - 都道府県選択 - </option>
				<option value="1">北海道</option>
				<option value="2">青森県</option>
				<option value="3">岩手県</option>
				<option value="4">宮城県</option>
				<option value="5">秋田県</option>
				<option value="6">山形県</option>
				<option value="7">福島県</option>
				<option value="8">茨城県</option>
				<option value="9">栃木県</option>
				<option value="10">群馬県</option>
				<option value="11">埼玉県</option>
				<option value="12">千葉県</option>
				<option value="13">東京都</option>
				<option value="14">神奈川県</option>
				<option value="15">新潟県</option>
				<option value="16">富山県</option>
				<option value="17">石川県</option>
				<option value="18">福井県</option>
				<option value="19">山梨県</option>
				<option value="20">長野県</option>
				<option value="21">岐阜県</option>
				<option value="22">静岡県</option>
				<option value="23">愛知県</option>
				<option value="24">三重県</option>
				<option value="25">滋賀県</option>
				<option value="26">京都府</option>
				<option value="27">大阪府</option>
				<option value="28">兵庫県</option>
				<option value="29">奈良県</option>
				<option value="30">和歌山県</option>
				<option value="31">鳥取県</option>
				<option value="32">島根県</option>
				<option value="33">岡山県</option>
				<option value="34">広島県</option>
				<option value="35">山口県</option>
				<option value="36">徳島県</option>
				<option value="37">香川県</option>
				<option value="38">愛媛県</option>
				<option value="39">高知県</option>
				<option value="40">福岡県</option>
				<option value="41">佐賀県</option>
				<option value="42">長崎県</option>
				<option value="43">熊本県</option>
				<option value="44">大分県</option>
				<option value="45">宮崎県</option>
				<option value="46">鹿児島県</option>
				<option value="47">沖縄県</option>
			</select>
		</div>
	</center>

</body>

</html>
